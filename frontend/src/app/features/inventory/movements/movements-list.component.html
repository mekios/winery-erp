<app-page-header
  title="Stock Movements"
  subtitle="Track inventory purchases, adjustments, and usage"
  icon="truck">
  <div actions>
    <button
      mat-flat-button
      color="primary"
      (click)="openMovementDialog()"
      class="header-action-button">
      <app-icon name="plus" />
      Record Movement
    </button>
  </div>
</app-page-header>

<div class="content-container">
  @if (loading()) {
    <div class="loading-state">
      <app-skeleton height="80px" count="5" />
    </div>
  } @else if (error()) {
    <app-error-state
      [message]="error()!"
      (retry)="loadMovements()">
    </app-error-state>
  } @else if (movements().length === 0) {
    <div class="empty-state">
      <app-icon name="truck" [size]="48" />
      <h3>No Stock Movements</h3>
      <p>Record purchases, adjustments, or transfers to track inventory</p>
      <button mat-flat-button color="primary" (click)="openMovementDialog()">
        Record Movement
      </button>
    </div>
  } @else {
    <div class="movements-list">
      @for (movement of movements(); track movement.id) {
        <div class="movement-card">
          <div class="movement-header">
            <div class="movement-info">
              <mat-chip [ngClass]="getMovementTypeClass(movement.movement_type)">
                {{ movement.movement_type_display }}
              </mat-chip>
              <h3 class="material-name">{{ movement.material_name }}</h3>
            </div>
            <div class="movement-quantity" [ngClass]="getQuantityClass(movement)">
              {{ movement.quantity > 0 ? '+' : '' }}{{ movement.quantity | number:'1.0-2' }} {{ movement.unit_display }}
            </div>
          </div>

          <div class="movement-details">
            <div class="detail-row">
              <span class="label">Location:</span>
              <span class="value">{{ movement.location_display }}</span>
            </div>

            @if (movement.destination_location_display) {
              <div class="detail-row">
                <span class="label">Destination:</span>
                <span class="value">{{ movement.destination_location_display }}</span>
              </div>
            }

            @if (movement.reference_number) {
              <div class="detail-row">
                <span class="label">Reference:</span>
                <span class="value">{{ movement.reference_number }}</span>
              </div>
            }

            @if (movement.unit_cost) {
              <div class="detail-row">
                <span class="label">Unit Cost:</span>
                <span class="value">€{{ movement.unit_cost | number:'1.2-2' }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Total Cost:</span>
                <span class="value total-cost">€{{ (movement.unit_cost * movement.quantity) | number:'1.2-2' }}</span>
              </div>
            }

            <div class="detail-row">
              <span class="label">Date:</span>
              <span class="value">{{ movement.movement_date | date:'medium' }}</span>
            </div>

            @if (movement.notes) {
              <div class="detail-row notes">
                <span class="label">Notes:</span>
                <span class="value">{{ movement.notes }}</span>
              </div>
            }

            @if (movement.created_by_name) {
              <div class="detail-row meta">
                <span class="label">Recorded by:</span>
                <span class="value">{{ movement.created_by_name }}</span>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</div>

