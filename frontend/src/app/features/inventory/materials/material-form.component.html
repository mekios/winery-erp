<app-page-header
  [title]="isEditMode ? 'Edit Material' : 'Add Material'"
  [subtitle]="isEditMode ? 'Update material information' : 'Add a new winemaking material'"
  icon="flask"
  [showBackButton]="true"
  backRoute="/inventory/materials">
</app-page-header>

<div class="form-container">
  @if (loading()) {
    <div class="loading-skeleton">
      <app-skeleton height="56px" count="8" />
    </div>
  } @else {
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <!-- Name -->
        <mat-form-field class="full-width">
          <mat-label>Material Name</mat-label>
          <input matInput formControlName="name" placeholder="e.g., Potassium Metabisulfite" />
          <mat-error>{{ getErrorMessage('name') }}</mat-error>
        </mat-form-field>

        <!-- Code -->
        <mat-form-field>
          <mat-label>Product Code (Optional)</mat-label>
          <input matInput formControlName="code" placeholder="e.g., SO2-KMS-100" />
          <mat-error>{{ getErrorMessage('code') }}</mat-error>
        </mat-form-field>

        <!-- Category -->
        <mat-form-field>
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            @for (category of categories(); track category.value) {
              <mat-option [value]="category.value">{{ category.label }}</mat-option>
            }
          </mat-select>
          <mat-error>{{ getErrorMessage('category') }}</mat-error>
        </mat-form-field>

        <!-- Unit -->
        <mat-form-field>
          <mat-label>Unit of Measurement</mat-label>
          <mat-select formControlName="unit">
            @for (unit of units(); track unit.value) {
              <mat-option [value]="unit.value">{{ unit.label }}</mat-option>
            }
          </mat-select>
          <mat-error>{{ getErrorMessage('unit') }}</mat-error>
        </mat-form-field>

        <!-- Supplier -->
        <mat-form-field>
          <mat-label>Supplier (Optional)</mat-label>
          <input matInput formControlName="supplier" placeholder="e.g., WineChem Supplies" />
          <mat-error>{{ getErrorMessage('supplier') }}</mat-error>
        </mat-form-field>

        <!-- Low Stock Threshold -->
        <app-number-input
          formControlName="low_stock_threshold"
          label="Low Stock Threshold (Optional)"
          [decimals]="2"
          [min]="0"
          placeholder="Alert when stock falls below">
        </app-number-input>

        <!-- Notes -->
        <mat-form-field class="full-width">
          <mat-label>Notes (Optional)</mat-label>
          <textarea
            matInput
            formControlName="notes"
            rows="4"
            placeholder="Additional notes, specifications, or usage instructions"></textarea>
          <mat-error>{{ getErrorMessage('notes') }}</mat-error>
        </mat-form-field>

        <!-- Is Active -->
        <div class="checkbox-field full-width">
          <mat-checkbox formControlName="is_active">
            Active (uncheck to archive this material)
          </mat-checkbox>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          mat-stroked-button
          (click)="onCancel()"
          [disabled]="saving()">
          Cancel
        </button>
        <button
          type="submit"
          mat-flat-button
          color="primary"
          [disabled]="saving()">
          @if (saving()) {
            <span>Saving...</span>
          } @else {
            <span>{{ isEditMode ? 'Update' : 'Create' }} Material</span>
          }
        </button>
      </div>
    </form>
  }
</div>

